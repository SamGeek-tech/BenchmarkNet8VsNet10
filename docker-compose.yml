services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_USER: benchmark
      POSTGRES_PASSWORD: password
      POSTGRES_DB: benchmark_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: "Password123!"
    ports:
      - "1433:1433"

  nginx:
    image: nginx:alpine
    ports:
      - "8080:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - benchmark-api-8
      - benchmark-api-10

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana

  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'

  # Placeholder for API services if we were to containerize them fully
  benchmark-api-8:
    image: mcr.microsoft.com/dotnet/aspnet:8.0
    # build: ./BenchmarkApi8
    command: [ "dotnet", "BenchmarkApi8.dll" ]
    environment:
      - ASPNETCORE_URLS=http://+:80

  benchmark-api-10:
    image: mcr.microsoft.com/dotnet/nightly/aspnet:10.0
    # build: ./BenchmarkApi10
    command: [ "dotnet", "BenchmarkApi10.dll" ]
    environment:
      - ASPNETCORE_URLS=http://+:80

volumes:
  postgres_data:
  grafana_data:
